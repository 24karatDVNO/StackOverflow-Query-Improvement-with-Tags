<p>Try using <a href="http://maxmind.com" rel="nofollow">maxmind.com</a> - this will do a geo lookup based on IP address. They have a free or paid for database that your store on your server. They have a <a href="http://www.maxmind.com/app/ruby" rel="nofollow">Ruby API</a>. I use this in a production system and the lookups are typically sub-millisecond as the data is cached.</p>