<p>Maybe you can have a look at the source code of <strong>scrot</strong></p>