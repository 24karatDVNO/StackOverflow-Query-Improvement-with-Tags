<p>I think it's better if the transaction is inside the loop.</p>