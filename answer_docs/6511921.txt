<p>You can add if-then logic in your XQuery expression that will add different amounts of XML depending on which nodes exist. This approach allows you the most flexibility, since it can be programmed to handle almost any possible situation, such as where /data exists, but not /data/a. You could even decide what to do when the root document element is not <code>&lt;data&gt;</code>. </p>

<p>As for the COALESCE(), I like it and consider it a worthy workaround for the condition you've described.</p>