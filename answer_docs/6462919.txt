<p>The usual problem is that <code>discard</code> is <code>nil</code>. I don't see it being initialized so I am guess that is the case here too. </p>