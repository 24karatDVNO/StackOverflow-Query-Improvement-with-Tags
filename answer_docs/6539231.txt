<p>Perhaps try to use unordered_multimap.  It could be that some insertions fail because of equal keys.  Then the counts will not match up.</p>