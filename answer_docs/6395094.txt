<p>You could split the main task into two subroutine.</p>

<p>You could move with the approach first retrieve all <strong>id/key</strong> value then get the <strong>id</strong> for the latest value of <code>A</code> and <code>B</code> keys,</p>

<p>Now you could easly write a query to get latest value for <code>A</code> and <code>B</code> because you have value of <strong>id's</strong> for both <code>A</code> and <code>B</code> keys.</p>