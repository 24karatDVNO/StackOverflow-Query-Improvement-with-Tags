<p>XML::Twig using the XPath class looks like it would be handy.  But this sounds a bit like a job for an XSLT stylesheet.  I guess it depends on the xml file you are handling though...</p>